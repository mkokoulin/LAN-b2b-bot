build:
  hello-world:
    image: okteto.dev/go-hello-world:1.0.0
    context: .
    args:
      SCOPE: ${SCOPE}
      TELEGRAM_TOKEN: ${TELEGRAM_TOKEN}
      BUILDER_SPREADSHEET_ID: ${BUILDER_SPREADSHEET_ID}
      BUILDER_READ_RANGE: ${BUILDER_READ_RANGE}
      REQUESTS_SPREADSHEET_ID: ${REQUESTS_SPREADSHEET_ID}
      REQUESTS_READ_RANGE: ${REQUESTS_READ_RANGE}
      GOOGLE_CLOUD_CONFIG: ${GOOGLE_CLOUD_CONFIG}

deploy:
  - kubectl set env Deployment SCOPE=${SCOPE} TELEGRAM_TOKEN=${TELEGRAM_TOKEN} BUILDER_SPREADSHEET_ID=${BUILDER_SPREADSHEET_ID} BUILDER_READ_RANGE=${BUILDER_READ_RANGE} REQUESTS_SPREADSHEET_ID=${REQUESTS_SPREADSHEET_ID} REQUESTS_READ_RANGE=${REQUESTS_READ_RANGE} GOOGLE_CLOUD_CONFIG=${GOOGLE_CLOUD_CONFIG}
  - kubectl apply -f k8s.yml

dev:
  hello-world:
    image: okteto/golang:1
    command: bash
    sync:
      - .:/usr/src/app
    volumes:
      - /go
      - /root/.cache
    securityContext:
      capabilities:
        add:
          - SYS_PTRACE
    forward:
      - 2345:2345